<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" type="text/css" href="src/css/adminpanel.css" media="screen">
</head>
<body>
    <header>
        <img src="/src/logo/tbs1_logo.jpg" alt="TBS1 Logo" style="width: 150px;height: 50px;" class="float-left logo"/>
        <h1>Admin Panel</h1>
    </header>
    <nav>
        <ul>
            <li><button id="dashboard-link" onclick="fetchData('http://localhost:5000/database', '#table-container', ['Nutzer_id', 'Station', 'Verbrauch', 'Datum'])">Dashboard</button></li>
            <li><button id="verwalten-link" onclick="fetchData('http://localhost:5000/nutzer', '#table-container', ['Nutzer_id'])">Benutzer verwalten</button></li>
            <li><button id="addUserButton" onclick="showAddUserForm()" ondblclick="hideAddUserForm()">Add User</button></li>
            <li><button id="deleteUserButton" onclick="showDeleteUserForm()" ondblclick="hideDeleteUserForm()">Delete User</button></li>
        </ul>
    </nav>
    
    <main>
        <h2>Dashboard</h2>
        <p>Willkommen im Admin Panel.</p>
        <table id="table-container"></table>
        <div id="addUserForm" style="display: none;">
            <h3>Add User</h3>
            <form id="userForm">
                <label for="userID">User ID:</label>
                <input type="text" id="userID" name="userID" required><br><br>
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required><br><br>
                <input type="submit" value="Submit">
            </form>
        </div>
        <div id="deleteUserForm" style="display: none;">
            <h3>Delete User</h3>
            <form id="userForm2">
                <label for="userID2">User ID:</label>
                <input type="text" id="userID2" name="userID2" required><br><br>
                <input type="submit" value="Submit">
            </form>
        </div>
    </main>
    <footer>
        &copy; 2024 Admin Panel. Alle Rechte vorbehalten.
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function fetchData(url, tableId, headers) {
            $.ajax({
                url: url,
                type: "GET",
                dataType: "json",
                success: function (data) {
                    var table = $(tableId);
                    table.empty();
                    table.append("<tr>");
                    $.each(headers, function (index, value) {
                        table.append("<th>" + value + "</th>");
                    });
                    table.append("</tr>");
                    $.each(data, function (index, value) {
                        table.append("<tr>");
                        $.each(headers, function (headerIndex, headerValue) {
                            table.append("<td>" + value[headerValue.toLowerCase()] + "</td>");
                        });
                        table.append("</tr>");
                    });
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + error);
                }
            });
        }
    
        function showAddUserForm() {
            $("#addUserForm").show();
        }
    
        function hideAddUserForm() {
            $("#addUserForm").hide();
        }

        function showDeleteUserForm() {
            $("#deleteUserForm").show();
        }

        function hideDeleteUserForm() {
            $("#deleteUserForm").hide();
        }
        function addUser() {
            var userID = $("#userID").val();
            var password = $("#password").val();
            

            $.ajax({
                url: "http://localhost:5000/adduser",
                type: "POST",
                data: {
                    userID: userID,
                    password: password
                },
                success: function (response) {

                    console.log("User added successfully!");
                    alert("User added successfully!");
                    hideAddUserForm();
                    fetchData('http://localhost:5000/nutzer', '#table-container', ['Nutzer_id']);
                },
                error: function (xhr, status, error) {

                    console.log("Error: " + error);
                    alert("Error: " + error);
                }
            });
        }
    
        function deleteUser() {
            var userID = $("#userID2").val();

            $.ajax({
                url: "http://localhost:5000/deleteuser",
                type: "POST",
                data: {
                    userID: userID,
                },
                success: function (response) {

                    console.log("User deleted successfully!");
                    alert("User deleted successfully!");
                    hideAddUserForm();
                    fetchData('http://localhost:5000/nutzer', '#table-container', ['Nutzer_id']);
                },
                error: function (xhr, status, error) {

                    console.log("Error: " + error);
                    alert("Error: " + error);
                }
            });

        }
    
        $(document).ready(function () {
            hideAddUserForm();
            hideDeleteUserForm();
            $("#userForm").submit(function (event) {
                event.preventDefault();
                addUser();
            });
    
            $("#userForm2").submit(function (event) {
                event.preventDefault();
                deleteUser();
            });
        });
    </script>
</body>
</html>
