<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="src/css/adminpanel.css" media="screen">
</head>
<body>
    <header>
        <img src="/src/logo/tbs1_logo.jpg" alt="TBS1 Logo" class="logo"/>
        <h1>Admin Panel</h1>
    </header>
    <nav>
        <ul>
            <li><button id="dashboard-link" onclick="fetchData('http://localhost:5000/database', '#table-container', ['Nutzer_id', 'Station', 'Verbrauch', 'Datum']); toggleForm('#dashboardForm'); hideFormsExcept('#dashboardForm');">Dashboard</button></li>
            <li><button id="benutzer-verwalten" onclick="fetchData('http://localhost:5000/nutzer', '#table-container', ['Nutzer_id']); toggleForm('#benutzerForm'); hideFormsExcept('#benutzerForm');">Benutzer verwalten</button></li>
            <li><button id="addUserButton" onclick="toggleForm('#'); hideFormsExcept('#addUserForm');">Add User</button></li>
            <li><button id="deleteUserButton" onclick="toggleForm('#deleteUserForm'); hideFormsExcept('#deleteUserForm');">Delete User</button></li>
            <li><button id="prevButton" onclick="navigatePage('prev')">Prev</button></li>
            <li><button id="nextButton" onclick="navigatePage('next')">Next</button></li>
            <li><button id="filterDashboard" onclick="filterDashboard()">Dashboard filtern</button></li>
        </ul>
    </nav>
    
    <main>
        <h2>Dashboard</h2>
        <p>Willkommen im Admin Panel.</p>
        <div id="table-container"></div>
        <div id="addUserForm" class="form" style="display: none;">
            <h3>Add User</h3>
            <form id="userForm">
                <label for="userID">User ID:</label>
                <input type="text" id="userID" name="userID" required><br><br>
                <label for="password">Password:</label>
                <input type="password" id="password" name="password" required><br><br>
                <input type="submit" value="Submit">
            </form>
        </div>
        <div id="deleteUserForm" class="form" style="display: none;">
            <h3>Delete User</h3>
            <form id="userForm2">
                <label for="userID2">User ID:</label>
                <input type="text" id="userID2" name="userID2" required><br><br>
                <input type="submit" value="Submit">
            </form>
        </div>
    </main>
    <footer>
        &copy; 2024 Admin Panel. Alle Rechte vorbehalten.
    </footer>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function fetchData(url, tableId, headers) {
            $.ajax({
                url: url,
                type: "GET",
                dataType: "json",
                success: function (data) {
                    var table = $("<table></table>");
                    var thead = $("<tr></tr>");
                    $.each(headers, function (index, value) {
                        thead.append("<th>" + value + "</th>");
                    });
                    table.append(thead);
                    $.each(data, function (index, value) {
                        var row = $("<tr></tr>");
                        $.each(headers, function (headerIndex, headerValue) {
                            row.append("<td>" + value[headerValue.toLowerCase()] + "</td>");
                        });
                        table.append(row);
                    });
                    $(tableId).html(table);
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + error);
                }
            });
        }
    
        function toggleForm(formId) {
            $(formId).toggle();
        }

        function hideFormsExcept(activeFormId) {
            const forms = ['#dashboardForm', '#benutzerForm', '#addUserForm', '#deleteUserForm'];
            forms.forEach(function(formId) {
                if(formId !== activeFormId) {
                    $(formId).hide();
                }
            });
        }

        function addUser() {
            var userID = $("#userID").val();
            var password = $("#password").val();
            
            $.ajax({
                url: "http://localhost:5000/adduser",
                type: "POST",
                data: {
                    userID: userID,
                    password: password
                },
                success: function (response) {
                    console.log("User added successfully!");
                    alert("User added successfully!");
                    $("#addUserForm").hide();
                    fetchData('http://localhost:5000/nutzer', '#table-container', ['Nutzer_id']);
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + error);
                    alert("Error: " + error);
                }
            });
        }
    
        function deleteUser() {
            var userID = $("#userID2").val();

            $.ajax({
                url: "http://localhost:5000/deleteuser",
                type: "POST",
                data: {
                    userID: userID,
                },
                success: function (response) {
                    console.log("User deleted successfully!");
                    alert("User deleted successfully!");
                    $("#deleteUserForm").hide();
                    fetchData('http://localhost:5000/nutzer', '#table-container', ['Nutzer_id']);
                },
                error: function (xhr, status, error) {
                    console.log("Error: " + error);
                    alert("Error: " + error);
                }
            });
        }
        
        function navigatePage(direction) {
            console.log("Navigating to: " + direction + " page");
            fetchData('http://localhost:5000/database', '#table-container', ['Nutzer_id', 'Station', 'Verbrauch', 'Datum']);
            fetchData('http://localhost:5000/nutzer', '#table-container', ['Nutzer_id']);
        }
        
        function filterDashboard() {
            console.log("Filtering the dashboard");
        }
    
        $(document).ready(function () {
            $("#userForm").submit(function (event) {
                event.preventDefault();
                addUser();
            });
    
            $("#userForm2").submit(function (event) {
                event.preventDefault();
                deleteUser();
            });
        });
    </script>
</body>
</html>
